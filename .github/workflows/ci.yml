name: CI

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install ruff pytest
          # Coming soon: pip install skills-ref

      - name: Validate skill
        run: |
          # Validate skill spec compliance using skills-ref
          # Install: pip install skills-ref
          # Local run: skills-ref validate skills/project-understanding
          echo "Skill validation: Checking SKILL.md exists..."
          test -f skills/project-understanding/SKILL.md && echo "SKILL.md found ✓"
          echo "Note: Full validation requires 'skills-ref validate skills/project-understanding'"

      - name: Lint with ruff
        run: |
          # Check Python files for linting errors
          if find . -name "*.py" -type f | grep -q .; then
            ruff check .
            ruff format --check .
          else
            echo "No Python files found to lint"
          fi

      - name: Run tests
        run: |
          pytest --tb=short -q

  docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check documentation
        run: |
          # Verify required documentation files exist
          test -f README.md || (echo "README.md missing!" && exit 1)
          test -f LICENSE || (echo "LICENSE missing!" && exit 1)
          test -f skills/project-understanding/SKILL.md || (echo "SKILL.md missing!" && exit 1)
          echo "Documentation files verified ✓"

      - name: Check skill structure
        run: |
          # Verify skill directory structure
          test -d skills/project-understanding || (echo "Skill directory missing!" && exit 1)
          test -d skills/project-understanding/assets || (echo "assets directory missing!" && exit 1)
          test -d skills/project-understanding/references || (echo "references directory missing!" && exit 1)
          test -d skills/project-understanding/scripts || (echo "scripts directory missing!" && exit 1)
          echo "Skill structure verified ✓"
